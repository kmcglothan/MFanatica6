tinymce.PluginManager.add('jrembed', function (editor, url)
{
    function showDialog(ui, tab) {
        var w = (tinymce.DOM.getViewPort().w - 200);
        if (w > 1140) {
            w = 1140;
        }
        var h = (tinymce.DOM.getViewPort().h - 200);
        if (h > 800) {
            h = 800;
        }
        editor.windowManager.open({
            title: 'Embed Local Media',
            url: core_system_url + '/' + jrEmbed_url + '/tabs/default=' + tab + '/__ajax=1',
            width:  w,
            height: h,
            buttons: [
                {
                    text: 'Close',
                    onclick: 'close'
                }
            ]
        });
    }
    editor.addCommand('jrembed', function(ui, v) {
        showDialog(ui, v);
    });
    editor.addButton('jrembed', {
        icon: 'media',
        name: 'jrembed',
        tooltip: "Embed Local Media",
        onclick: showDialog
    });
    editor.shortcuts.add('ctrl+shift+e', "Embed Local Media", function(ui, v){
        showDialog(ui, v);
    });
    editor.shortcuts.add('ctrl+e', "Embed Local Media", function(ui, v){
        showDialog(ui, v);
    });
});